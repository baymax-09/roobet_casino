openapi: 3.0.0
info:
  title: Ember API
  version: 1.0.0
servers:
  - url: 'https://roobet.com/_api/ember'
paths:
  /transfer:
    post:
      summary: Transfer
      description: Used to initiate transfer of funds from Ember to Roobet.
      parameters:
        - in: header
          name: x-signature
          required: true
          schema:
            type: string
          description: >-
            A signature generated by the client to verify the request body.
            Should be aes-256-cbc encrypted with the encryption key provided by Roobet, concatenated with an IV and separated by a colon (:).
            The data to be encrypted should
            be a stringified JSON blob with the properties `ember_user_id` and
            `amount_usd`, and should match the values in the request body.

            Here's an example in TypeScript of how you might generate the signature:

            ```typescript

            import crypto from 'crypto'


            // Using the aes-256-cbc encryption algorithm

            const ENCRYPTION_ALGO = 'aes-256-cbc'

            // Generate a random 16 byte initialization vector

            const iv = crypto.randomBytes(8).toString('hex')

            // Replace with the 32 byte key provided by Roobet

            const key = 'IT_MUST_BE_THIRTY_TWO_CHARACTERS'


            // Replace with your user id and the amount you want to transfer

            const data = JSON.stringify({
              ember_user_id: 'your-user-id',
              amount_usd: 100,
            })


            // Create a cipher using the encryption algorithm, key, and iv

            const cipher = crypto.createCipheriv(ENCRYPTION_ALGO, Buffer.from(key), iv)

            let encrypted = cipher.update(data, 'utf8', 'hex')

            encrypted += cipher.final('hex')


            const signature = `${encrypted}:${iv}`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ember_user_id:
                  type: string
                  description: The Ember user ID.
                amount_usd:
                  type: number
                  description: The amount in USD.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indicates whether the operation was successful.
                  detail:
                    type: string
                    description: Provides more information about the operation.
              examples:
                Success:
                  value:
                    success: true
                    detail: Transfer successful
                Error crediting Roobet balance:
                  value:
                    success: false
                    detail: Failed to credit balance for transfer
                Miscellaneous error:
                  value:
                    success: false
                    detail: An error occurred
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: The error message.
              examples:
                Invalid amount:
                  value:
                    message: 'Invalid param: [amount_usd]'
                Missing Ember ID:
                  value:
                    message: 'Missing param: [ember_user_id]'
                Missing amount:
                  value:
                    message: 'Missing param: [amount_usd]'
                Missing linked account:
                  value:
                    message: No linked account found for this emberId
                Missing user for emberId:
                  value:
                    message: No linked user found for this emberId
        '401':
          description: Unauthorized
          content:
            text/plain:
              schema:
                type: string
              examples:
                Invalid x-signature header:
                  value: Invalid signature
                Provided x-signature header does not match request body:
                  value: Unauthorized request
